---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const { title = 'code-onigiri' , meta = "code-onigiri's homepage" } = Astro.props;

const pathname = Astro.url.pathname.replace(/\/+$/, "") || "/";
const segments = pathname === "/" ? [] : pathname.split("/").filter(Boolean);

let pathAccumulator = "";
const breadcrumbs = [
  { label: "Home", href: "/" },
  ...segments.map((segment) => {
    pathAccumulator += `/${segment}`;
    const label = segment
      .split("-")
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(" ");
    return { label, href: pathAccumulator };
  }),
];
---
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={meta} />
    <slot name="head" />

    <!-- set theme early to avoid flash -->
    <script src="/theme-init.js" is:inline></script>
  </head>
  <body>
    <div
      class="page-wrap min-h-screen flex flex-col gap-6 w-full sm:w-4/5 lg:w-3/5 max-w-5xl mx-auto px-6 sm:px-8 lg:px-10 py-10 sm:py-12"
      x-data="{ dark: false }"
      x-init="dark = (localStorage.getItem('theme') === 'dark') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches); document.documentElement.classList.toggle('dark', dark)"
    >
      <Header breadcrumbs={breadcrumbs} />

      <main class="flex flex-col gap-5 sm:gap-6"><slot /></main>

      <Footer />
    </div>
  </body>
</html>
