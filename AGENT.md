# AGENT: レトロスペクティブ（短縮版）

**目的**
- 自動作業での誤りを再発させないための反省点と改善策を記録する。

**主要な問題と対策**
- ユーザー承認不足：変更前に短い提案で承認を取得する。 
- レイアウト適用ミス：`src/pages`/`src/layouts` を事前確認する。 
- クライアント初期化ミス：Astro とフレームワークコンポーネントの実行対象を明確化する。
- アセット404：パス検証とブラウザ/curl での確認を必須にする。
- 検証不足：小さなテストページで段階的に確認する。

**主な改善・成功事例**
- パンくずの縦揃え問題をリセット（list リセット + items-baseline）。
- アイコンセット不足を `@iconify-json/line-md` を追加して解消。
- アイコン切替にアニメーションを導入して状態変化を可視化。
- テーマ初期化を `public/theme-init.js` に分離、Alpine 初期化をコンポーネント化。
- ブログ最新5件の取得は `getCollection("blog")`→ソート→`.slice(0,5)` で実装。

**Alpine.js を使ったブログフィルタ**
- サーバー側で記事データを JSON 整形（ISO 日付文字列含む）してクライアントで処理。
- `x-data` に直接埋め込む方法と、必要に応じて `window` に関数を公開してスコープ問題を回避。
- 検索・タグ選択・日付ソートをクライアントで組み合わせて動作。

**ビルド最適化**
- `bun` 導入で依存インストール・開発が高速化。
- `oxlint`（Rust 製リンター）を追加して高速な静的解析を実現。
- `astro.config.mjs` に terser/minify や画像最適化の設定を追加。

**重要な修正**
- `wrangler.jsonc` の `name` を `my-homepage` に変更し、dev 起動エラーを解消。

**次の提案**
- 将来的に rolldown 検討、`oxlintrc.json` のルール調整。

**参照**
- 実装例: src/pages/blog/index.astro

---
**今回の振り返り**
- うまくいかなかったこと: タイポグラフィやコード表示の指定が散在して統一感が出にくかった。
- なぜうまくいったか: 変数化したフォントと行間を全体で参照し、コードブロック専用フォントを明示したことで一貫性と可読性が両立できた。

**追記**
- うまくいかなかったこと: ヘッダー要素の高さと並びの基準が曖昧で視線のズレが起きた。
- なぜうまくいったか: 高さと行送りを揃え、ボタン位置を基準に合わせたことで整列が改善した。概要は情報量を削って一行ずつに整理した。

**追記2**
- うまくいかなかったこと: 「概要」の対象がTOCであることを見落とし、別のセクションを簡略化してしまった。
- なぜうまくいったか: TOC専用のスタイルを用意して装飾を抑え、箇条書きの見た目を簡潔にできた。

---
更新: 要点のみを抽出した短縮版に変更。

---
**追記3**
- うまくいかなかったこと: ブログページのスタイルがページ内に散在し、タグやフォームの見た目が箇所ごとに微妙に違って保守が重かった。
- なぜうまくいったか: 共通クラス（フォーム、タグチップ、アクティブ/非アクティブ）を全体CSSに集約し、日付ソートも数値化して再計算コストを削減できた。

**追記4**
- うまくいかなかったこと: グローバルな`ul/ol`スタイルがナビゲーションにも適用され、ヘッダーのパンくず位置がずれた。
- なぜうまくいったか: リストのスタイルを`main`配下に限定して、本文とナビゲーションを分離できた。

**追記5**
- うまくいかなかったこと: 関連ページの導線がホームに無く、見つけにくかった。
- なぜうまくいったか: 専用ページを追加し、ホームに明確なリンクセクションを設置して導線を固定できた。

**追記6**
- うまくいかなかったこと: 日本語と英語の段落・見出しで折り返しやカーニングの方針が曖昧で、表示が環境によって不安定だった。
- なぜうまくいったか: 言語別のベースルールとユーティリティを明文化し、適用範囲を限定することで可読性と一貫性を両立できた。