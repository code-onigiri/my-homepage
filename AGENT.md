# AGENT: レトロスペクティブ（反省点）

**目的**: 今後の自動作業で同じミスを繰り返さないための注意点をまとめる。

## 🔧 実施時の問題と改善策

1. **ユーザー承認を取らずに実装を始めた** ✅
   - 改善: どの段階でユーザー承認が必要かを明確にし、必ず確認メッセージを送るルールを徹底する。

2. **レイアウト適用が正しく反映されない（+layout / layouts の扱い）** 🧭
   - 改善: プロジェクト構成（`src/pages/+layout.astro` の有無、`src/layouts/` の存在）を最初に明示的に確認してから変更する。

3. **クライアント初期化を間違った形式で実装した** ⚠️
   - 具体例: Astro コンポーネントに `client:*` を付けてしまった → Astro コンポーネントはクライアントでハイドレートできない。
   - 改善: クライアントで動かすコードはフレームワークのコンポーネントか、`<script type="module">` に置く。実装後にdevサーバの警告ログを必ず確認する。

4. **アセットやスタイルのパスで 404 が出た** 🧩
   - 改善: `link rel="stylesheet" href="/styles/..."` 等を追加したときはブラウザ（または curl）で確認し、404 が出たらパスやビルド設定を検証する。

5. **変更を段階的に検証しなかった** 🔁
   - 改善: 小さなテストページ（例: `src/pages/_test-layout.astro`）を作って、レイアウトとハイドレーションを素早く検証するワークフローを標準化する。

## ✅ 次回からのルール（チェックリスト）

- [ ] 変更前にユーザーへ短い提案を送り、承認を得る
- [ ] 最初にリポジトリのレイアウト構造を確認する（`src/pages`, `src/layouts`）
- [ ] クライアント実行コードは `client:*` を付ける対象が適正か確認する（Astro vs framework コンポーネント）
- [ ] 重要な変更は小さなコミット単位で行い、説明を付ける

## 📝 今回の試行錯誤ログ（パンくず位置ズレ）

- うまくいかなかった: グローバルのリスト余白とリンク下線のスタイルが残り、`flex` で整列しても境界線・パディングの差で縦位置が揺れたままになった。
- うまくいった: パンくずリストを `list-none`・`m-0 p-0` でリセットし、`items-baseline` と統一した `leading` を適用。リンクの下線装飾を消し、区切り文字も同じ行送りにして上下ブレを解消した。

## 📝 今回の試行錯誤ログ（アイコンセット欠如）

- うまくいかなかった: `line-md` アイコンを指定したが、対応する Iconify セットを依存に追加しておらず、astro-icon がアイコンセットを解決できずにビルドエラーになった。
- うまくいった: `@iconify-json/line-md` を dev 依存に追加し、astro-icon がセットを解決できる状態にした。

## 📝 今回の試行錯誤ログ（アニメーション切り替え）

- うまくいかなかった: アイコンを単に表示するだけでは、切り替え時の視覚フィードバックが乏しく、暗黙の状態が伝わりにくかった。
- うまくいった: `line-md:moon-alt-to-sunny-outline-loop-transition` を単一アイコンで使い、回転＋色のトランジションを付けて状態変化が分かるようにした。あわせてパンくず props に型を付け、暗黙 any を解消した。

## 📝 今回の試行錯誤ログ（生JSの分離）

- うまくいかなかった: テーマ初期化と Alpine 起動をインラインの生 JS で書いており、再利用性と見通しが悪かった。
- うまくいった: テーマ初期化を `public/theme-init.js` に切り出し、Alpine 起動を `AlpineInit.astro` コンポーネント化して再利用できる形にした。

---

**注意（環境）**: このワークスペースは GitHub Codespaces 上の特殊な開発環境です。動作確認（dev サーバの起動やブラウザでの確認）はユーザーの Codespace 上で行ってください。エージェントは変更の提案と実装を行いますが、最終的な検証は必ずユーザー環境でお願いします。

作業を実施する際はこの `AGENT.md` を参照して進めます。